(function(a,b,c){var e=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),a.id=c,a.src="//connect.facebook.net/en_US/all.js#xfbml=1",e.parentNode.insertBefore(a,e))})(document,"script","facebook-jssdk");
var App={enableScrollToTop:function(){if(0<$(".navbar").length){$("body").append('<div id="scroll-to-top-div"><small><a class="btn btn-inverse btn-small" href="#"><i class="icon-arrow-up icon-white"></i>&nbsp;Top</a></small></div>');var a=function(){$("#scroll-to-top-div").css("left",$("#navbar-position-marker").position().left+$("#navbar-position-marker div:first").width()-50+"px")};$(window).resize(function(){a()});a()}}},FeedbackPage={addComment:function(){$("#commentForm").click(function(a){$(this).children("input[type=submit]").attr("disabled",
"disabled");var b=$(this).children("textarea"),c=b.val();"undefined"!==jQuery.type(c)&&5<=c.length&&(console.log($(this).children("textarea").val()),$.ajax({type:"POST",dataType:"json",url:"/feedback/add",data:{text:c},success:function(a){FeedbackPage.addCommentElement(a);b.val("")}}));a.preventDefault();$(this).children("input[type=submit]").removeAttr("disabled")})},addCommentElement:function(a){a='<div class="well well-small"><span class="muted">'+moment.utc(a.createdAt).fromNow()+"</span><br/>"+
a.text+"</div>";$("#comments-div").prepend(a)},listComment:function(){$.ajax({type:"GET",dataType:"json",url:"/feedback/list",success:function(a){$.each(a,function(a,c){FeedbackPage.addCommentElement(c)})}})},enable:function(){FeedbackPage.addComment();FeedbackPage.listComment()}},IndexPage={tagMasterArray:[],tagNotDisplayedArray:[],tagToDisplayArray:[],tagRecord:null,columnArray:[],noOfColumns:0,calculateNoOfColumns:function(){var a=$(".tag-details-columns :first").position().top;$(".tag-details-columns").each(function(){a===
$(this).position().top?IndexPage.noOfColumns+=1:$(this).remove()})},init:function(){this.calculateNoOfColumns()},getTags:function(){var a=this;$.ajax({url:"/tag/get",success:function(b){$.each(b,function(b,e){a.tagMasterArray.push(e.name);30>b&&$("#tag-results-column"+b%5).append('<a href="/catalog/details?tag='+encodeURIComponent(e.name)+'"><span class=" "><small>'+e.name+"&nbsp;</small></span></a><br/>")});a.tagNotDisplayedArray=a.tagMasterArray;a.populateResults()}})},toggleLoadingTagSpinner:function(){},
populateResults:function(){var a=this;a.tagToDisplayArray=[];for(var b=1;b<=2*a.noOfColumns;b++)a.tagToDisplayArray.push(a.tagNotDisplayedArray.shift());$.each(a.tagToDisplayArray,function(b,e){$.ajax({type:"POST",dataType:"json",url:"/catalog/search?tag="+encodeURIComponent(e),success:function(b){var c='<table class="table table-condensed tag-table" tag="'+e+'"><caption><h5 class="text-info"><a href="/catalog/details?tag='+encodeURIComponent(e)+'" class="tag-link">'+e+"</a></h5></caption>";$.each(b,
function(a,b){var e=b.averageRating;"undefined"===typeof b.averageRating&&(e="n/a");c=c+'<tr class="tag-details-record" netflixId="'+b.netflixId+'" recordId="'+b._id+'"><td><i class="icon-chevron-right"></i></td><td><a href="#" class="tag-details-record-link"><small><span class="tag-details-record-title">'+b.title+'</span></small></a></td><td><a href="#" class="tag-details-record-link"><small>'+b.releaseYear+'</small></a></td><td><a href="#" class="tag-details-record-link"><small>'+e+"</small></a></td></tr>"});
c+="</table>";if(0===a.columnArray.length)for(b=1;b<=a.noOfColumns;b++)a.columnArray.push(b);$("#tag-details-hidden-column"+a.columnArray.shift()).append(c);a.tagToDisplayArray.shift();0===a.tagNotDisplayedArray.length&&$("#tag-loading-indicator-div").remove();0===a.tagToDisplayArray.length&&$(".tag-details-hidden").each(function(){for(var b={},c=[],e=1;e<=a.noOfColumns;e++)b[e]=$("#tag-details-results-column"+e).height(),c.push($("#tag-details-results-column"+e).height());for(var d in b)if(b[d]===
_.min(c)){$("#tag-details-results-column"+d).append($(this).html());$(this).html("");break}})}})})},throttledShowTagRecordDetails:function(){$(document).on({click:function(){var a=$(this).attr("recordId"),b=$(this).attr("netflixId"),c=$(this).parent().parent().attr("tag"),e="record-details-"+a;!1===_.isUndefined(IndexPage.tagRecord)&&(!1===_.isNull(IndexPage.tagRecord)&&IndexPage.tagRecord.attr("recordId")!=a)&&IndexPage.tagRecord.popover("hide");$.ajax({type:"GET",dataType:"json",url:"/catalog/get?recordId="+
a+"&tag="+encodeURIComponent(c),success:function(d){var f=[];$.each(d.cast,function(a,b){-1===$.inArray(b.name,f)&&f.push(b.name)});var g=[];$.each(d.directors,function(a,b){-1===$.inArray(b.name,g)&&g.push(b.name)});html='<div class="tag-details-record-popover"><small><a href="#" class="pull-right tag-details-record-popover-close"><i class="icon-remove"></i></a><b>'+d.title+'</b><span class="text-info">&nbsp;&nbsp;'+d.releaseYear+'</span><table><tr><td width="40%" class="box-art"><img src="'+d.boxArt+
'"/><br/><a href="#" onclick="javascript:nflx.addToQueue(\''+b+"', null, null, 'qaptap7nutk88e7k7z8hh68f', 'instant', '"+e+'\');"><span><strong>Add to Instant Queue</strong></span></a></td><td width="60%">'+d.shortSynopsis+'</td></tr><td colspan="2"><b>Cast: </b>'+f.join(", ")+"<br/><b>Directors: </b>"+g.join(", ")+'<br/><a href="/catalog/details?tag='+encodeURIComponent(c)+"&anchor=anchor-"+a+'">More >></a></td><tr></tr></table></small></div>';$("#"+e).html(html)}});var d={html:!0,trigger:"focus",
placement:"top"};d.content='<div id="'+e+'">'+$(this).parent()+"</div>";$(this).popover(d);$(this).popover("show");IndexPage.tagRecord=$(this)},mouseleave:function(){}},".tag-details-record");$(document).on("click",".tag-details-record-popover-close",function(a){!1===_.isUndefined(IndexPage.tagRecord)&&IndexPage.tagRecord.popover("hide");a.preventDefault()});$(document).on("click",".tag-details-record-link",function(a){a.preventDefault()})}};
IndexPage.throttledPopulateResults=_.throttle(function(){IndexPage.populateResults()},2E3);IndexPage.configureScroll=function(){$(window).scroll(function(){var a=$(this).scrollTop()+$(window).height(),b=$(".tag-table :last").position().top+$(".tag-table :last").height();a>1*b&&IndexPage.throttledPopulateResults()})};
IndexPage.configureSearch=function(){$(".typeahead").typeahead({source:function(a,b){var c={};c.keyWords=[a];$.ajax({type:"POST",dataType:"json",data:c,url:"/catalog/search",success:function(c){var d=[];$.each(c,function(b,c){0<=c.title.toLowerCase().indexOf(a.toLowerCase())&&-1===$.inArray(c.title,d)&&d.push(c.title);$.each(c.cast,function(a,b){-1===$.inArray(b.name,d)&&d.push(b.name)});$.each(c.directors,function(a,b){-1===$.inArray(b.name,d)&&d.push(b.name)})});return b(d)}})}})};
IndexPage.enable=function(){IndexPage.init();IndexPage.getTags();IndexPage.configureScroll();IndexPage.throttledShowTagRecordDetails();IndexPage.configureSearch();App.enableScrollToTop()};
var DetailsPage={initalize:function(a,b){this.tag={name:a,searchParam:b||{}};this.searchParam={genres:b.genres||[],releaseYears:b.releaseYears||[],averageRatings:b.averageRatings||[],keyWords:b.keyWords||[],showExpiringSoon:b.showExpiringSoon||!1,pageNumber:b.pageNumber||1,pageSize:b.pageSize||25,orderBy:b.orderBy||"averageRating",sort:b.sort||"desc"};this.noMoreResults=!1},init:function(a){a=a||{};this.searchParam.pageNumber=1;this.noMoreResults=!1;"undefined"!==jQuery.type(a.orderBy)&&(!0===a.toggleSort&&
this.searchParam.orderBy===a.orderBy&&(this.searchParam.sort="asc"===this.searchParam.sort?"desc":"asc"),this.searchParam.orderBy=a.orderBy)},hasNoMoreResults:function(){return!0===this.noMoreResults},updateSearchParam:function(){var a=this.searchParam;a.genres=[];a.releaseYears=[];a.averageRatings=[];a.showExpiringSoon=!1;$.each($(".side-bar-genres-checkbox"),function(b,c){!0===c.checked&&a.genres.push(c.value)});$.each($(".side-bar-releaseYears-checkbox"),function(b,c){!0===c.checked&&a.releaseYears.push(c.value)});
$.each($(".side-bar-averageRatings-checkbox"),function(b,c){!0===c.checked&&a.averageRatings.push(c.value)});a.showExpiringSoon=DetailsPage.showExpiring()||!1},getSearchParam:function(){return this.searchParam},getSearchParam:function(){return this.searchParam},fetchData:function(a){$.ajax({type:"POST",dataType:"json",data:this.searchParam,url:"/catalog/search",success:function(b){a(b)}})},showExpiring:function(){return $("#side-bar-expiring-soon")[0].checked},generateResultsRow:function(a,b){var c=
"detail-record-"+a.recordId,c='<tr id="'+c+'"><td><small><a id="anchor-'+a.recordId+'"><img src="'+a.boxArt+'"/></a><br/><b>'+a.title+'</b><br/><a href="#" class="" onclick="javascript:nflx.addToQueue(\''+a.netflixId+"', null, null, 'qaptap7nutk88e7k7z8hh68f', 'instant', '"+c+"');return false;\">Add to Instant Queue</a></small></small></td><td><small>"+a.releaseYear+"</small></td><td><small>"+(a.averageRating||"n/a")+'</small></td><td><div class="detailed-synopsis"><small><div>'+a.synopsis+"</div>",
e="";!0===b.showExpiringSoon&&(e="text-error");c=c+'<div class="'+e+'"><b>Expiring On: </b>&nbsp;'+moment.utc(a.availableUntil).format("MM/DD/YYYY")+" (in "+moment.utc(a.availableUntil).diff(moment(),"days")+" days)</div>";return c=c+"<div><b>Genres: </b>"+a.genres+"</div><div><b>Cast: </b>"+a.cast+"</div><b>Directors: </b>"+a.directors+"</small></div></td></tr>"},performPreFetch:function(){1===this.searchParam.pageNumber&&$("#results-table tbody").html("")},performPostFetch:function(){this.searchParam.pageNumber++},
parseData:function(a){var b="";0===a.length&&(DetailsPage.noMoreResults=!0,b='<span class="muted"><small>No More Results</small></span>',$("#results-table-loading-indicator-div").remove());var c=DetailsPage.showExpiring();$.each(a,function(a,d){var j=d.averageRating;"undefined"===jQuery.type(d.averageRating)&&(j="n/a");var f=[];$.each(d.genres,function(a,b){-1===$.inArray(b.name,f)&&f.push(b.name)});var g=[];$.each(d.cast,function(a,b){-1===$.inArray(b.name,g)&&g.push(b.name)});var h=[];$.each(d.directors,
function(a,b){-1===$.inArray(b.name,h)&&h.push(b.name)});b+=DetailsPage.generateResultsRow({title:d.title,releaseYear:d.releaseYear,averageRating:j,synopsis:d.synopsis,cast:g.join(", "),directors:h.join(", "),genres:f.join(", "),availableUntil:d.availableUntil,netflixId:d.netflixId,recordId:d._id,boxArt:d.boxArt},{showExpiringSoon:c})});$("#results-table tbody").append(b);DetailsPage.performPostFetch()},populateResults:function(){!1===this.hasNoMoreResults()&&(this.updateSearchParam(),this.performPreFetch(),
this.fetchData(this.parseData))}};DetailsPage.throttledPopulateResults=_.throttle(function(){DetailsPage.populateResults()},2E3);
DetailsPage.enable=function(){$(".side-bar-field").click(function(a){var b=$(this),c=!1;b.parent().children(".side-bar-div").toggle();c=b.parent().hasClass("active")?!0:!1;$(".side-bar-field").parent().removeClass("active");!0===c?b.parent().removeClass("active"):b.parent().addClass("active");a.preventDefault()});$.ajax({url:"/stat/get",success:function(a){$("#genres-container").html("");var b=function(a,b){$("#side-bar-"+b).append('<div class="side-bar-sall-checkbox" ><label class="checkbox"><small>Select/Clear All</small><input id="side-bar-'+
b+'-sall-checkbox" type="checkbox"></label></div>');$.each(a,function(a,c){var f='<div><label class="checkbox"><small>'+c.name+'</small><input id="'+b+"-checkbox-"+c.id+'" class="side-bar-checkbox side-bar-'+b+'-checkbox" type="checkbox" value="'+c.id+'">&nbsp;<span class="text-info"><small>('+c.count+")</span></b></label></div>";$("#side-bar-"+b).append(f)})};b(a.genres,"genres");b(a.releaseYears,"releaseYears");b(a.averageRatings,"averageRatings");"undefined"!==jQuery.type(DetailsPage.tag.searchParam.genres)&&
$.each(DetailsPage.tag.searchParam.genres,function(a,b){$("#genres-checkbox-"+b).prop("checked",!0)});"undefined"!==jQuery.type(DetailsPage.tag.searchParam.releaseYears)&&$.each(DetailsPage.tag.searchParam.releaseYears,function(a,b){$("#releaseYears-checkbox-"+b).prop("checked",!0)});"undefined"!==jQuery.type(DetailsPage.tag.searchParam.showExpiringSoon)&&$("#side-bar-expiring-soon").prop("checked",!0);DetailsPage.init();DetailsPage.populateResults()}});$(".sortable").click(function(a){DetailsPage.init({orderBy:$(this).attr("value"),
toggleSort:!0});DetailsPage.populateResults();a.preventDefault()});$(document).on("click",".side-bar-checkbox",function(){DetailsPage.init();DetailsPage.populateResults();$.each(["genres","averageRatings","releaseYears"],function(a,b){document.getElementById("side-bar-"+b+"-sall-checkbox").checked=!0;$.each($(".side-bar-"+b+"-checkbox"),function(a,e){!1===e.checked&&$("#side-bar-"+b+"-sall-checkbox").removeAttr("checked")})})});$.each(["genres","averageRatings","releaseYears"],function(a,b){$(document).on("click",
"#side-bar-"+b+"-sall-checkbox",function(){var a=$(this)[0];$.each($(".side-bar-"+b+"-checkbox"),function(b,d){d.checked=a.checked});DetailsPage.init();DetailsPage.populateResults()})});$("#side-bar-expiring-soon").parent().tooltip();$("#side-bar-expiring-soon").parent().click(function(a){$("#side-bar-expiring-soon")[0].checked=!$("#side-bar-expiring-soon")[0].checked;$("#side-bar-expiring-soon").trigger("click");a.preventDefault()});$(window).scroll(function(){var a=$(this).scrollTop()+$(window).height(),
b=$("#results-table").position().top+$("#results-table").height();a>1*b&&DetailsPage.throttledPopulateResults()});App.enableScrollToTop()};